@model List<DentalDesign.Dashboard.Models.Case.CaseViewModel>
<h2>@ViewBag.DesignerName Cases</h2>

@if (Model.Count == 0)
{
    <h3>No Cases To Show</h3>
}
else
{
    <form>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Case Name</th>
                    <th>Case Type</th>
                    <th>Description</th>
                    <th>Status</th>
                    @if (ViewBag.UserRoleId == 1 || ViewBag.UserRoleId == 2)
                    {
                       <th>Assigned For</th>    
                    }
                    <th>Assigned At</th>
                    <th>Due Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cas in Model)
                {
                    <tr data-id="@cas.Id">
                        <td>
                            <a href="@Url.Action("Details", "Case", new { id = cas.Id })"
                               class="ajax-link"
                               data-case-id="@cas.Id">
                                @cas.CaseName
                            </a>
                        </td>
                        <td>@cas.CaseTypeName</td>
                        <td>@cas.Description</td>
                        <td class="status-cell">@cas.StatusName</td>
                        @if (ViewBag.UserRoleId == 1 || ViewBag.UserRoleId == 2)
                        {
                            <td class="designer-cell" data-designer-id="@cas.DesignerId">
                                @cas.DesignerName
                            </td>
                        }
                        <td>@cas.AssignedAt</td>
                        <td>@cas.DueDate</td>
                        <td>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    Actions
                                </button>

                                <ul class="dropdown-menu">

                                    <!-- Change Status -->
                                    <li>
                                        <a class="dropdown-item change-status-btn"
                                           href="#"
                                           data-id="@cas.Id"
                                           data-current="@cas.StatusId">
                                            Change Status
                                        </a>
                                    </li>

                                    <!-- Assign to Designer (Admin = 1, Supervisor = 2) -->
                                    @if (ViewBag.UserRoleId == 1 || ViewBag.UserRoleId == 2)
                                    {
                                        <li>
                                            <a class="dropdown-item assign-designer-btn"
                                               href="#"
                                               data-id="@cas.Id">
                                                Assign To Designer
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </form>

    <!-- Pagination (if needed) -->
    @if (ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
    {
        <nav>
            <ul class="pagination">
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link ajax-link"
                           href="@Url.Action("Index", "Case", new { id = ViewBag.DesignerId, page = i })">
                            @i
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }

    <!-- case status Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <select class="form-control" id="statusSelect">
                        @foreach (var status in Enum.GetValues(typeof(Case.Domain.Enum.CaseStatusEnum)))
                        {
                            <option value="@((int)status)">@status</option>
                        }
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveStatus">Save</button>
                </div>
            </div>
        </div>
    </div>

  
}

